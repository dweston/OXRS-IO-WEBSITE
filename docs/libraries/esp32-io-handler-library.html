<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.26">
    <title>ESP32 I/O handler library | OXRS Docs</title><meta name="description" content="The Open eXtensible Rack System">
    <link rel="preload" href="/assets/js/runtime~app.0f0626d7.js" as="script"><link rel="preload" href="/assets/css/styles.9505feca.css" as="style"><link rel="preload" href="/assets/js/8567.c9de17ef.js" as="script"><link rel="preload" href="/assets/js/app.8b53c3ee.js" as="script">
    <link rel="stylesheet" href="/assets/css/styles.9505feca.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><img class="logo" src="/images/hero.png" alt="OXRS Docs"><span class="site-name can-hide">OXRS Docs</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Docs"><span class="title">Docs</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="Docs"><span class="title">Docs</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/docs/hardware" class="nav-link" aria-label="Hardware"><!--[--><!--]--> Hardware <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/docs/firmware" class="nav-link" aria-label="Firmware"><!--[--><!--]--> Firmware <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/docs/libraries" class="nav-link router-link-active" aria-label="Libraries"><!--[--><!--]--> Libraries <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/docs/cases" class="nav-link" aria-label="Cases"><!--[--><!--]--> Cases <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Add-ons"><span class="title">Add-ons</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="Add-ons"><span class="title">Add-ons</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/add-ons/accessibility" class="nav-link" aria-label="Accessibility"><!--[--><!--]--> Accessibility <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/add-ons/displays" class="nav-link" aria-label="Displays"><!--[--><!--]--> Displays <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/add-ons/switches" class="nav-link" aria-label="Switches"><!--[--><!--]--> Switches <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Guides"><span class="title">Guides</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="Guides"><span class="title">Guides</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/guides/start" class="nav-link" aria-label="Getting started"><!--[--><!--]--> Getting started <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/guides/advanced" class="nav-link" aria-label="Advanced"><!--[--><!--]--> Advanced <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/guides/standards" class="nav-link" aria-label="Standards"><!--[--><!--]--> Standards <!--[--><!--]--></a></li><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>Writing Docs</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a href="/guides/writing-docs/getting-started.md" class="nav-link" aria-label="Getting Started"><!--[--><!--]--> Getting Started <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/guides/writing-docs/markdown.md" class="nav-link" aria-label="Markdown Guide"><!--[--><!--]--> Markdown Guide <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/guides/writing-docs/templates/README.md" class="nav-link" aria-label="Doc Templates"><!--[--><!--]--> Doc Templates <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Glossary"><span class="title">Glossary</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="Glossary"><span class="title">Glossary</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/glossary/skus.md" class="nav-link" aria-label="SKU&#39;s"><!--[--><!--]--> SKU&#39;s <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/glossary/makers.md" class="nav-link" aria-label="Makers"><!--[--><!--]--> Makers <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/glossary/acronyms.md" class="nav-link" aria-label="Acronyms"><!--[--><!--]--> Acronyms <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/OXRS-IO/" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Docs"><span class="title">Docs</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="Docs"><span class="title">Docs</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/docs/hardware" class="nav-link" aria-label="Hardware"><!--[--><!--]--> Hardware <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/docs/firmware" class="nav-link" aria-label="Firmware"><!--[--><!--]--> Firmware <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/docs/libraries" class="nav-link router-link-active" aria-label="Libraries"><!--[--><!--]--> Libraries <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/docs/cases" class="nav-link" aria-label="Cases"><!--[--><!--]--> Cases <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Add-ons"><span class="title">Add-ons</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="Add-ons"><span class="title">Add-ons</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/add-ons/accessibility" class="nav-link" aria-label="Accessibility"><!--[--><!--]--> Accessibility <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/add-ons/displays" class="nav-link" aria-label="Displays"><!--[--><!--]--> Displays <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/add-ons/switches" class="nav-link" aria-label="Switches"><!--[--><!--]--> Switches <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Guides"><span class="title">Guides</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="Guides"><span class="title">Guides</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/guides/start" class="nav-link" aria-label="Getting started"><!--[--><!--]--> Getting started <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/guides/advanced" class="nav-link" aria-label="Advanced"><!--[--><!--]--> Advanced <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/guides/standards" class="nav-link" aria-label="Standards"><!--[--><!--]--> Standards <!--[--><!--]--></a></li><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>Writing Docs</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a href="/guides/writing-docs/getting-started.md" class="nav-link" aria-label="Getting Started"><!--[--><!--]--> Getting Started <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/guides/writing-docs/markdown.md" class="nav-link" aria-label="Markdown Guide"><!--[--><!--]--> Markdown Guide <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/guides/writing-docs/templates/README.md" class="nav-link" aria-label="Doc Templates"><!--[--><!--]--> Doc Templates <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Glossary"><span class="title">Glossary</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="Glossary"><span class="title">Glossary</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/glossary/skus.md" class="nav-link" aria-label="SKU&#39;s"><!--[--><!--]--> SKU&#39;s <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/glossary/makers.md" class="nav-link" aria-label="Makers"><!--[--><!--]--> Makers <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/glossary/acronyms.md" class="nav-link" aria-label="Acronyms"><!--[--><!--]--> Acronyms <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/OXRS-IO/" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><a href="/docs/libraries/README.md" class="nav-link sidebar-heading sidebar-item active" aria-label="Libraries"><!--[--><!--]--> Libraries <!--[--><!--]--></a><ul class=""><li><!--[--><p class="sidebar-item active">ESP32</p><ul class="sidebar-sub-items"><li><!--[--><a href="/docs/libraries/esp32-mqtt-library.html" class="nav-link sidebar-item" aria-label="ESP32 MQTT library"><!--[--><!--]--> ESP32 MQTT library <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/docs/libraries/esp32-api-library.html" class="nav-link sidebar-item" aria-label="ESP32 API library"><!--[--><!--]--> ESP32 API library <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/docs/libraries/esp32-lcd-library.html" class="nav-link sidebar-item" aria-label="ESP32 LCD library"><!--[--><!--]--> ESP32 LCD library <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/docs/libraries/esp32-io-handler-library.html" class="router-link-active router-link-exact-active nav-link router-link-active sidebar-item active" aria-label="ESP32 I/O handler library"><!--[--><!--]--> ESP32 I/O handler library <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/docs/libraries/esp32-io-handler-library.html#introduction" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Introduction"><!--[--><!--]--> Introduction <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/docs/libraries/esp32-io-handler-library.html#how-does-it-work" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="How does it work?"><!--[--><!--]--> How does it work? <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/docs/libraries/esp32-io-handler-library.html#usm-input-h" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="USM_Input.h"><!--[--><!--]--> USM_Input.h <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/docs/libraries/esp32-io-handler-library.html#usm-output-h" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="USM_Output.h"><!--[--><!--]--> USM_Output.h <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/docs/libraries/esp32-io-handler-library.html#configuration" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Configuration"><!--[--><!--]--> Configuration <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/docs/libraries/esp32-io-handler-library.html#usm-input-h-1" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="USM_Input.h"><!--[--><!--]--> USM_Input.h <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/docs/libraries/esp32-io-handler-library.html#usm-output-h-1" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="USM_Output.h"><!--[--><!--]--> USM_Output.h <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/docs/libraries/esp32-io-handler-library.html#downloads" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Downloads"><!--[--><!--]--> Downloads <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/docs/libraries/esp32-io-handler-library.html#supported-hardware" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Supported Hardware"><!--[--><!--]--> Supported Hardware <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li></ul><!--]--></li></ul><!--]--><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="esp32-i-o-handler-library" tabindex="-1"><a class="header-anchor" href="#esp32-i-o-handler-library" aria-hidden="true">#</a> ESP32 I/O handler library</h1><p class="maker">by <b>SuperHouse Automation</b></p><blockquote><p>SKU: OXRS-SHA-IOHandler-ESP32-LIB</p></blockquote><h2 id="introduction" tabindex="-1"><a class="header-anchor" href="#introduction" aria-hidden="true">#</a> Introduction</h2><p>This library serves two functions, for input monitoring and output control. It can monitor buttons, switches, contacts, or any binary sensor, and report events back to the caller. It can also listen for binary commands and passes control events back to the caller.</p><p>Typically used with MCP23017 I2C I/O buffers to detect digital signals being pulled to GND (inputs) and to control relays (outputs).</p><hr><h3 id="how-does-it-work" tabindex="-1"><a class="header-anchor" href="#how-does-it-work" aria-hidden="true">#</a> How does it work?</h3><p>The library contains two classes which can be used independently or together, depending on what your firmware is trying to do.</p><h3 id="usm-input-h" tabindex="-1"><a class="header-anchor" href="#usm-input-h" aria-hidden="true">#</a> <code>USM_Input.h</code></h3><p>Monitors and maintains state for up to 16 inputs. Takes 16 bits of binary data and checks each value against an internal state machine to determine if any input events have occurred.</p><h3 id="usm-output-h" tabindex="-1"><a class="header-anchor" href="#usm-output-h" aria-hidden="true">#</a> <code>USM_Output.h</code></h3><p>Waits for commands and generates control events for up to 16 outputs. Keeps track of output state and handles interlocking and timers.</p><h2 id="configuration" tabindex="-1"><a class="header-anchor" href="#configuration" aria-hidden="true">#</a> Configuration</h2><h3 id="usm-input-h-1" tabindex="-1"><a class="header-anchor" href="#usm-input-h-1" aria-hidden="true">#</a> <code>USM_Input.h</code></h3><p>Each of the 16 inputs can be configured as either <code>BUTTON</code>, <code>CONTACT</code>, <code>ROTARY</code>, <code>SWITCH</code> or <code>TOGGLE</code>. Different events will be generated depending on the configured type, and the sequence of state changes.</p><p>Each of the 16 inputs can also be inverted, so events are generated on <code>LOW</code> -&gt; <code>HIGH</code> transitions instead of <code>HIGH</code> -&gt; <code>LOW</code>.</p><h4 id="rotary-encoders" tabindex="-1"><a class="header-anchor" href="#rotary-encoders" aria-hidden="true">#</a> Rotary Encoders</h4><p>A pair of inputs can be set as <code>ROTARY</code> inputs, and connected to an <a href="https://lastminuteengineers.com/rotary-encoder-arduino-tutorial/" target="_blank" rel="noopener noreferrer">incremental rotary encoder<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>. The library will decode the signals from the encoder and generate <code>LOW_EVENT</code> or <code>HIGH_EVENT</code> events, depending which way the encoder is turned.</p><h4 id="functions" tabindex="-1"><a class="header-anchor" href="#functions" aria-hidden="true">#</a> Functions</h4><ul><li><code>setType(input, type)</code>: Set the input type</li><li><code>setInvert(input, invert)</code>: Invert input handling</li></ul><h4 id="code-example" tabindex="-1"><a class="header-anchor" href="#code-example" aria-hidden="true">#</a> Code Example</h4><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Adafruit_MCP23X17.h&gt;</span>        <span class="token comment">// For MCP23017 I/O buffers</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;OXRS_Input.h&gt;</span>               <span class="token comment">// For input handling</span></span>

<span class="token comment">// I/O buffers</span>
Adafruit_MCP23X17 mcp23017<span class="token punctuation">;</span>

<span class="token comment">// Input handlers</span>
OXRS_Input oxrsInput<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Initialise the MCP chip (assume at address 0x20)</span>
  mcp23017<span class="token punctuation">.</span><span class="token function">begin_I2C</span><span class="token punctuation">(</span><span class="token number">0x20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Set every pin to be INPUT with internal PULLUPs enabled</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">uint8_t</span> pin <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> pin <span class="token operator">&lt;</span> <span class="token number">16</span><span class="token punctuation">;</span> pin<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    mcp23017<span class="token punctuation">.</span><span class="token function">pinMode</span><span class="token punctuation">(</span>pin<span class="token punctuation">,</span> INPUT_PULLUP<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// Initialise the input handler</span>
  oxrsInput<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span>inputEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Configurate types and invert state here</span>
  <span class="token comment">//oxrsInput.setType(0, BUTTON);</span>
  <span class="token comment">//oxrsInput.setInvert(0, 1);</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Read the values for all 16 inputs on this MCP in one hit</span>
  <span class="token keyword">uint16_t</span> io_value <span class="token operator">=</span> mcp23017<span class="token punctuation">.</span><span class="token function">readGPIOAB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Check for any input events</span>
  oxrsInput<span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> io_value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">inputEvent</span><span class="token punctuation">(</span><span class="token keyword">uint8_t</span> id<span class="token punctuation">,</span> <span class="token keyword">uint8_t</span> input<span class="token punctuation">,</span> <span class="token keyword">uint8_t</span> type<span class="token punctuation">,</span> <span class="token keyword">uint8_t</span> state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Code to handle the event goes in here!</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><h3 id="usm-output-h-1" tabindex="-1"><a class="header-anchor" href="#usm-output-h-1" aria-hidden="true">#</a> <code>USM_Output.h</code></h3><p>Each of the 16 outputs can be configured as either <code>MOTOR</code>, <code>RELAY</code>, or <code>TIMER</code>. Different control signals will be generated depending on the configured type.</p><h4 id="interlocking" tabindex="-1"><a class="header-anchor" href="#interlocking" aria-hidden="true">#</a> Interlocking</h4><p>Interlocking two outputs allows them to control equipment such as roller blinds, garage doors, louvre roofing etc.</p><p>If two outputs are interlocked it means they can&#39;t be <code>on</code> at the same time. E.g. if output A and B are interlocked, and an <code>on</code> command is sent to output B while output A is <code>on</code>, output A will automatically turn <code>off</code> and after a short delay output B will then turn <code>on</code>.</p><h4 id="timers" tabindex="-1"><a class="header-anchor" href="#timers" aria-hidden="true">#</a> Timers</h4><p>Timers allow an output to automatically turn <code>off</code> a set number of seconds after being turned <code>on</code> (configurable but defaults to 60 seconds).</p><p>If another <code>on</code> command is sent while the timer is running, it will reset to zero and begin counting down again. If an <code>off</code> command is sent the timer will be cancelled and the output turned <code>off</code> immediately.</p><h4 id="functions-1" tabindex="-1"><a class="header-anchor" href="#functions-1" aria-hidden="true">#</a> Functions</h4><ul><li><code>setType(output, type)</code>: Set the output type</li><li><code>setInterlock(output, interlock)</code>: Interlock an output with another</li><li><code>setTimer(output, seconds)</code>: Set the timer duration (in seconds)</li></ul><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>The only difference between <code>MOTOR</code> and <code>RELAY</code> outputs is the interlock delay. For <code>MOTOR</code> outputs the delay is 2000ms, for <code>RELAY</code> outputs it is only 500ms.</p></div><h4 id="code-example-1" tabindex="-1"><a class="header-anchor" href="#code-example-1" aria-hidden="true">#</a> Code Example</h4><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Adafruit_MCP23X17.h&gt;</span>        <span class="token comment">// For MCP23017 I/O buffers</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;OXRS_Output.h&gt;</span>              <span class="token comment">// For output handling</span></span>

<span class="token comment">// I/O buffers</span>
Adafruit_MCP23X17 mcp23017<span class="token punctuation">;</span>

<span class="token comment">// Input handlers</span>
OXRS_Output oxrsOutput<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Initialise the MCP chip (assume at address 0x20)</span>
  mcp23017<span class="token punctuation">.</span><span class="token function">begin_I2C</span><span class="token punctuation">(</span><span class="token number">0x20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Set every pin to OUTPUT</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">uint8_t</span> pin <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> pin <span class="token operator">&lt;</span> <span class="token number">16</span><span class="token punctuation">;</span> pin<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    mcp23017<span class="token punctuation">.</span><span class="token function">pinMode</span><span class="token punctuation">(</span>pin<span class="token punctuation">,</span> OUTPUT<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// Initialise the output handler</span>
  oxrsOutput<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span>outputEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Configurate types, interlocks and timers here</span>
  <span class="token comment">//oxrsOutput.setInterlock(0, 1);</span>
  <span class="token comment">//oxrsOutput.setInterlock(1, 0);</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Check for any output events</span>
  oxrsOutput<span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Need a way to receive commands - e.g. serial input or MQTT messages</span>
  <span class="token comment">//oxrsOutput.handleCommand(0, output, RELAY_ON);</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">outputEvent</span><span class="token punctuation">(</span><span class="token keyword">uint8_t</span> id<span class="token punctuation">,</span> <span class="token keyword">uint8_t</span> output<span class="token punctuation">,</span> <span class="token keyword">uint8_t</span> type<span class="token punctuation">,</span> <span class="token keyword">uint8_t</span> state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Code to handle the event goes in here!</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><h2 id="downloads" tabindex="-1"><a class="header-anchor" href="#downloads" aria-hidden="true">#</a> Downloads</h2><p>Download the latest version of the firmware on <a href="https://github.com/SuperHouse/OXRS-SHA-IOHandler-ESP32-LIB" target="_blank" rel="noopener noreferrer">Github<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>.</p><h2 id="supported-hardware" tabindex="-1"><a class="header-anchor" href="#supported-hardware" aria-hidden="true">#</a> Supported Hardware</h2><p>Designed to run on ESP32 based devices.</p><ul><li><a href="/docs/hardware/controllers/rack32.html" class="">Rack32</a></li></ul><hr><h4 id="credits" tabindex="-1"><a class="header-anchor" href="#credits" aria-hidden="true">#</a> Credits</h4><ul><li><a href="https://oxrs.io/" target="_blank" rel="noopener noreferrer">OXRS<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> Core Team</li></ul><hr><h4 id="license" tabindex="-1"><a class="header-anchor" href="#license" aria-hidden="true">#</a> License</h4><p>Found <a href="https://github.com/SuperHouse/OXRS-SHA-IOHandler-ESP32-LIB/blob/main/LICENSE" target="_blank" rel="noopener noreferrer">here<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>.</p><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="nav-link external meta-item-label" href="https://github.com/OXRS-IO/OXRS-IO-WEBSITE/edit/main/docs/docs/libraries/esp32-io-handler-library.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page"><!--[--><!--]--> Edit this page <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><span class="meta-item-info">11/22/2021, 4:14:25 AM</span></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: aaron_knox@me.com">Aaron Knox</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: ben.jones12@gmail.com">Ben Jones</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: 70245481+austinscreations@users.noreply.github.com">austinscreations</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: ben.jones12@gmail.com">ben</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"> ← <a href="/docs/libraries/esp32-lcd-library.html" class="nav-link" aria-label="ESP32 LCD library"><!--[--><!--]--> ESP32 LCD library <!--[--><!--]--></a></span><!----></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script src="/assets/js/runtime~app.0f0626d7.js" defer></script><script src="/assets/js/8567.c9de17ef.js" defer></script><script src="/assets/js/app.8b53c3ee.js" defer></script>
  </body>
</html>
