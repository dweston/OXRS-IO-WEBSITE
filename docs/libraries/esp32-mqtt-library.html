<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.26">
    <title>ESP32 MQTT library | OXRS Docs</title><meta name="description" content="The Open eXtensible Rack System">
    <link rel="preload" href="/assets/js/runtime~app.0f0626d7.js" as="script"><link rel="preload" href="/assets/css/styles.9505feca.css" as="style"><link rel="preload" href="/assets/js/8567.c9de17ef.js" as="script"><link rel="preload" href="/assets/js/app.8b53c3ee.js" as="script">
    <link rel="stylesheet" href="/assets/css/styles.9505feca.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><img class="logo" src="/images/hero.png" alt="OXRS Docs"><span class="site-name can-hide">OXRS Docs</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Docs"><span class="title">Docs</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="Docs"><span class="title">Docs</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/docs/hardware" class="nav-link" aria-label="Hardware"><!--[--><!--]--> Hardware <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/docs/firmware" class="nav-link" aria-label="Firmware"><!--[--><!--]--> Firmware <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/docs/libraries" class="nav-link router-link-active" aria-label="Libraries"><!--[--><!--]--> Libraries <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/docs/cases" class="nav-link" aria-label="Cases"><!--[--><!--]--> Cases <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Add-ons"><span class="title">Add-ons</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="Add-ons"><span class="title">Add-ons</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/add-ons/accessibility" class="nav-link" aria-label="Accessibility"><!--[--><!--]--> Accessibility <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/add-ons/displays" class="nav-link" aria-label="Displays"><!--[--><!--]--> Displays <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/add-ons/switches" class="nav-link" aria-label="Switches"><!--[--><!--]--> Switches <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Guides"><span class="title">Guides</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="Guides"><span class="title">Guides</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/guides/start" class="nav-link" aria-label="Getting started"><!--[--><!--]--> Getting started <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/guides/advanced" class="nav-link" aria-label="Advanced"><!--[--><!--]--> Advanced <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/guides/standards" class="nav-link" aria-label="Standards"><!--[--><!--]--> Standards <!--[--><!--]--></a></li><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>Writing Docs</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a href="/guides/writing-docs/getting-started.md" class="nav-link" aria-label="Getting Started"><!--[--><!--]--> Getting Started <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/guides/writing-docs/markdown.md" class="nav-link" aria-label="Markdown Guide"><!--[--><!--]--> Markdown Guide <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/guides/writing-docs/templates/README.md" class="nav-link" aria-label="Doc Templates"><!--[--><!--]--> Doc Templates <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Glossary"><span class="title">Glossary</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="Glossary"><span class="title">Glossary</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/glossary/skus.md" class="nav-link" aria-label="SKU&#39;s"><!--[--><!--]--> SKU&#39;s <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/glossary/makers.md" class="nav-link" aria-label="Makers"><!--[--><!--]--> Makers <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/glossary/acronyms.md" class="nav-link" aria-label="Acronyms"><!--[--><!--]--> Acronyms <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/OXRS-IO/" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Docs"><span class="title">Docs</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="Docs"><span class="title">Docs</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/docs/hardware" class="nav-link" aria-label="Hardware"><!--[--><!--]--> Hardware <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/docs/firmware" class="nav-link" aria-label="Firmware"><!--[--><!--]--> Firmware <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/docs/libraries" class="nav-link router-link-active" aria-label="Libraries"><!--[--><!--]--> Libraries <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/docs/cases" class="nav-link" aria-label="Cases"><!--[--><!--]--> Cases <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Add-ons"><span class="title">Add-ons</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="Add-ons"><span class="title">Add-ons</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/add-ons/accessibility" class="nav-link" aria-label="Accessibility"><!--[--><!--]--> Accessibility <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/add-ons/displays" class="nav-link" aria-label="Displays"><!--[--><!--]--> Displays <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/add-ons/switches" class="nav-link" aria-label="Switches"><!--[--><!--]--> Switches <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Guides"><span class="title">Guides</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="Guides"><span class="title">Guides</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/guides/start" class="nav-link" aria-label="Getting started"><!--[--><!--]--> Getting started <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/guides/advanced" class="nav-link" aria-label="Advanced"><!--[--><!--]--> Advanced <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/guides/standards" class="nav-link" aria-label="Standards"><!--[--><!--]--> Standards <!--[--><!--]--></a></li><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>Writing Docs</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a href="/guides/writing-docs/getting-started.md" class="nav-link" aria-label="Getting Started"><!--[--><!--]--> Getting Started <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/guides/writing-docs/markdown.md" class="nav-link" aria-label="Markdown Guide"><!--[--><!--]--> Markdown Guide <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/guides/writing-docs/templates/README.md" class="nav-link" aria-label="Doc Templates"><!--[--><!--]--> Doc Templates <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Glossary"><span class="title">Glossary</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="Glossary"><span class="title">Glossary</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/glossary/skus.md" class="nav-link" aria-label="SKU&#39;s"><!--[--><!--]--> SKU&#39;s <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/glossary/makers.md" class="nav-link" aria-label="Makers"><!--[--><!--]--> Makers <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/glossary/acronyms.md" class="nav-link" aria-label="Acronyms"><!--[--><!--]--> Acronyms <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/OXRS-IO/" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><a href="/docs/libraries/README.md" class="nav-link sidebar-heading sidebar-item active" aria-label="Libraries"><!--[--><!--]--> Libraries <!--[--><!--]--></a><ul class=""><li><!--[--><p class="sidebar-item active">ESP32</p><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/docs/libraries/esp32-mqtt-library.html" class="router-link-active router-link-exact-active nav-link router-link-active sidebar-item active" aria-label="ESP32 MQTT library"><!--[--><!--]--> ESP32 MQTT library <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/docs/libraries/esp32-mqtt-library.html#introduction" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Introduction"><!--[--><!--]--> Introduction <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/docs/libraries/esp32-mqtt-library.html#how-does-it-work" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="How does it work?"><!--[--><!--]--> How does it work? <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/docs/libraries/esp32-mqtt-library.html#configuration" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Configuration"><!--[--><!--]--> Configuration <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/docs/libraries/esp32-mqtt-library.html#setup" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Setup"><!--[--><!--]--> Setup <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/docs/libraries/esp32-mqtt-library.html#client-id" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Client ID"><!--[--><!--]--> Client ID <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/docs/libraries/esp32-mqtt-library.html#broker-details" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Broker Details"><!--[--><!--]--> Broker Details <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/docs/libraries/esp32-mqtt-library.html#callbacks" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Callbacks"><!--[--><!--]--> Callbacks <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/docs/libraries/esp32-mqtt-library.html#program-loop" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Program Loop"><!--[--><!--]--> Program Loop <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/docs/libraries/esp32-mqtt-library.html#publishing" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Publishing"><!--[--><!--]--> Publishing <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/docs/libraries/esp32-mqtt-library.html#downloads" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Downloads"><!--[--><!--]--> Downloads <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/docs/libraries/esp32-mqtt-library.html#supported-hardware" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Supported Hardware"><!--[--><!--]--> Supported Hardware <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a href="/docs/libraries/esp32-api-library.html" class="nav-link sidebar-item" aria-label="ESP32 API library"><!--[--><!--]--> ESP32 API library <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/docs/libraries/esp32-lcd-library.html" class="nav-link sidebar-item" aria-label="ESP32 LCD library"><!--[--><!--]--> ESP32 LCD library <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/docs/libraries/esp32-io-handler-library.html" class="nav-link sidebar-item" aria-label="ESP32 I/O handler library"><!--[--><!--]--> ESP32 I/O handler library <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li></ul><!--]--><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="esp32-mqtt-library" tabindex="-1"><a class="header-anchor" href="#esp32-mqtt-library" aria-hidden="true">#</a> ESP32 MQTT library</h1><p class="maker">by <b>OXRS Core Team</b></p><blockquote><p>SKU: OXRS-IO-MQTT-ESP32-LIB</p></blockquote><h2 id="introduction" tabindex="-1"><a class="header-anchor" href="#introduction" aria-hidden="true">#</a> Introduction</h2><p>This library wraps up all MQTT related functions in an easy-to-use API, ensuring OXRS compatible events and config/command handlers. It includes the following;</p><ul><li>MQTT broker connection and re-connection attempts</li><li>Callbacks for connect/disconnect events</li><li>Callbacks for JSON messages received on the config/command topics</li><li>Simple API for publishing JSON-based status and telemetry data</li></ul><p>By using this library you can be sure your firmware will adhere to the OXRS standards and be compatible with other parts of the OXRS eco-system.</p><hr><h3 id="how-does-it-work" tabindex="-1"><a class="header-anchor" href="#how-does-it-work" aria-hidden="true">#</a> How does it work?</h3><p>This library is a wrapper around the Arduino <a href="https://github.com/knolleary/pubsubclient" target="_blank" rel="noopener noreferrer">PubSubClient<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> library by Nick O&#39;Leary. It forms the cornerstone of OXRS compatibility since MQTT is the protocol used for configuration, commands and status/telemetry reporting.</p><p>The library will automatically publish and subscribe to various topics, depending on how you use it;</p><table><thead><tr><th style="text-align:left;">Topic</th><th style="text-align:left;">Description</th></tr></thead><tbody><tr><td style="text-align:left;"><code>stat/&lt;clientid&gt;/lwt</code></td><td style="text-align:left;">Publishes <code>{&quot;online&quot;:true|false}</code> to this topic when connected/disconnected from the MQTT broker</td></tr><tr><td style="text-align:left;"><code>stat/&lt;clientid&gt;</code></td><td style="text-align:left;">Publishes JSON status messages to this topic via <code>publishStatus()</code></td></tr><tr><td style="text-align:left;"><code>tele/&lt;clientid&gt;</code></td><td style="text-align:left;">Publishes JSON telemetry messages to this topic via <code>publishTelemetry()</code></td></tr><tr><td style="text-align:left;"><code>stat/&lt;clientid&gt;/adopt</code></td><td style="text-align:left;">Publishes JSON adoption messages to this topic via <code>publishAdopt()</code></td></tr><tr><td style="text-align:left;"><code>conf/&lt;clientid&gt;</code></td><td style="text-align:left;">Subscribes to this topic for JSON config messages and passes them on to your <code>onConfig</code> callback</td></tr><tr><td style="text-align:left;"><code>cmnd/&lt;clientid&gt;</code></td><td style="text-align:left;">Subscribes to this topic for JSON command messages and passes them on to your <code>onCommand</code> callback</td></tr></tbody></table><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>These topics will be different if you set a topic prefix or suffix. E.g. a topic prefix of <code>home</code> and suffix of <code>oxrs</code> would result in a LWT topic of <code>home/stat/&lt;clientid&gt;/oxrs/lwt</code></p></div><h2 id="configuration" tabindex="-1"><a class="header-anchor" href="#configuration" aria-hidden="true">#</a> Configuration</h2><h3 id="setup" tabindex="-1"><a class="header-anchor" href="#setup" aria-hidden="true">#</a> Setup</h3><p>The library needs to be initialised with an instance of <code>PubSubClient</code>, which can be created for either WiFi or Ethernet connections. You also need to register a callback on your <code>PubSubClient</code> for incoming MQTT messages, and pass these events down to the MQTT library;</p><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">// MQTT client</span>
PubSubClient <span class="token function">_mqttClient</span><span class="token punctuation">(</span>_client<span class="token punctuation">)</span><span class="token punctuation">;</span>
OXRS_MQTT <span class="token function">_mqtt</span><span class="token punctuation">(</span>_mqttClient<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">_mqttCallback</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span> topic<span class="token punctuation">,</span> byte <span class="token operator">*</span> payload<span class="token punctuation">,</span> <span class="token keyword">int</span> length<span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
  <span class="token comment">// Pass down to our MQTT handler and check it was processed ok</span>
  <span class="token keyword">int</span> state <span class="token operator">=</span> _mqtt<span class="token punctuation">.</span><span class="token function">receive</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> payload<span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">case</span> MQTT_RECEIVE_ZERO_LENGTH<span class="token operator">:</span>
      Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">F</span><span class="token punctuation">(</span><span class="token string">&quot;Empty MQTT payload received&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> MQTT_RECEIVE_JSON_ERROR<span class="token operator">:</span>
      Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">F</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to deserialise MQTT JSON payload&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> MQTT_RECEIVE_NO_CONFIG_HANDLER<span class="token operator">:</span>
      Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">F</span><span class="token punctuation">(</span><span class="token string">&quot;No MQTT config handler&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> MQTT_RECEIVE_NO_COMMAND_HANDLER<span class="token operator">:</span>
      Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">F</span><span class="token punctuation">(</span><span class="token string">&quot;No MQTT command handler&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>The library will return a status code from <code>.receive()</code> indicating if it was able to successfully process the message. See <a href="https://github.com/OXRS-IO/OXRS-IO-MQTT-ESP32-LIB/blob/main/src/OXRS_MQTT.h" target="_blank" rel="noopener noreferrer"><code>OXRS_MQTT.h</code><span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> for the full list of return codes.</p><h3 id="client-id" tabindex="-1"><a class="header-anchor" href="#client-id" aria-hidden="true">#</a> Client ID</h3><p>A unique client id for the MQTT connection must be specified. Typically we use the last 6 bytes of the device MAC address, but you can use anything you like. The client id must be unique since if another device attempts to connect with the same client id, the broker will boot any existing connections with the same id. See <a href="https://www.cloudmqtt.com/blog/mqtt-what-is-client-id.html" target="_blank" rel="noopener noreferrer">here<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> for more details.</p><h3 id="broker-details" tabindex="-1"><a class="header-anchor" href="#broker-details" aria-hidden="true">#</a> Broker Details</h3><p>You need to tell the library where and how to connect to your MQTT broker of choice;</p><table><thead><tr><th style="text-align:left;">Broker Config</th><th style="text-align:left;">Description</th></tr></thead><tbody><tr><td style="text-align:left;"><code>setBroker</code></td><td style="text-align:left;">MQTT broker IP address or hostname, and port (typically <code>1883</code>)</td></tr><tr><td style="text-align:left;"><code>setAuth</code></td><td style="text-align:left;">Optional, the username and password to authenticate with your MQTT broker</td></tr><tr><td style="text-align:left;"><code>setTopicPrefix</code></td><td style="text-align:left;">Optional, a topic prefix applied to all subscriptions and publishes</td></tr><tr><td style="text-align:left;"><code>setTopicSuffix</code></td><td style="text-align:left;">Optional, a topic suffix applied to all subscriptions and publishes</td></tr></tbody></table><p>Only <code>setBroker()</code> is mandatory, the rest are optional.</p><h3 id="callbacks" tabindex="-1"><a class="header-anchor" href="#callbacks" aria-hidden="true">#</a> Callbacks</h3><p>Next add your callbacks for the various events supported by the library and register them with the MQTT library;</p><table><thead><tr><th style="text-align:left;">Callback Register</th><th style="text-align:left;">Description</th></tr></thead><tbody><tr><td style="text-align:left;"><code>onConnected</code></td><td style="text-align:left;">Successfully connected to the configured MQTT broker</td></tr><tr><td style="text-align:left;"><code>onDisconnected</code></td><td style="text-align:left;">Connection to the configured MQTT broker has dropped</td></tr><tr><td style="text-align:left;"><code>onConfig</code></td><td style="text-align:left;">JSON configuration payload received on the <code>conf/&lt;clientid&gt;</code> topic</td></tr><tr><td style="text-align:left;"><code>onCommand</code></td><td style="text-align:left;">JSON command payload received on the <code>cmnd/&lt;clientid&gt;</code> topic</td></tr></tbody></table><p>These are all optional, for example the <a href="/docs/firmware/state-monitor-esp32.html" class="">State Monitor</a> firmware has no need for the <code>onCommand</code> callback.</p><h3 id="program-loop" tabindex="-1"><a class="header-anchor" href="#program-loop" aria-hidden="true">#</a> Program Loop</h3><p>Finally your firmware needs to call the MQTT library <code>.loop()</code> method as often as possible, e.g. typically inside your main program <code>loop()</code> method. This allows the library to check for incoming MQTT messages, process outgoing messages, and do any other internal housekeeping.</p><h3 id="publishing" tabindex="-1"><a class="header-anchor" href="#publishing" aria-hidden="true">#</a> Publishing</h3><p>The library makes it very easy to publish JSON data by providing a set of simple APIs;</p><table><thead><tr><th style="text-align:left;">Publish API</th><th style="text-align:left;">Topic</th><th style="text-align:left;">Retained</th><th style="text-align:left;">Description</th></tr></thead><tbody><tr><td style="text-align:left;"><code>publishStatus</code></td><td style="text-align:left;"><code>stat/&lt;clientid&gt;</code></td><td style="text-align:left;">false</td><td style="text-align:left;">Publish a JSON <strong>status</strong> message, e.g. when a button event is detected</td></tr><tr><td style="text-align:left;"><code>publishTelemetry</code></td><td style="text-align:left;"><code>tele/&lt;clientid&gt;</code></td><td style="text-align:left;">false</td><td style="text-align:left;">Publish a JSON <strong>telemetry</strong> message, e.g. when publishing regular sensor data</td></tr><tr><td style="text-align:left;"><code>publishAdopt</code></td><td style="text-align:left;"><code>stat/&lt;clientid&gt;/adopt</code></td><td style="text-align:left;">true</td><td style="text-align:left;">Publish a JSON <strong>adoption</strong> message, typically firmware and network details plus JSON config/command schemas</td></tr></tbody></table><p>The adoption message is optional but is used by downstream systems in the OXRS eco-system to identify the device and provide a means for building self-describing configuration and control systems/UIs.</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>Typically you publish your adoption message in the <code>onConnected</code> callback so anything listening is alerted to your presence as soon as you come online</p></div><h2 id="downloads" tabindex="-1"><a class="header-anchor" href="#downloads" aria-hidden="true">#</a> Downloads</h2><p>Download the latest version of the library on <a href="https://github.com/OXRS-IO/OXRS-IO-MQTT-ESP32-LIB" target="_blank" rel="noopener noreferrer">Github<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>.</p><p>A good place to look for an example of how to use this MQTT library is in the <a href="/docs/hardware/controllers/rack32.html" class="">Rack32</a> library found <a href="https://github.com/SuperHouse/OXRS-SHA-Rack32-ESP32-LIB" target="_blank" rel="noopener noreferrer">here<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>.</p><h2 id="supported-hardware" tabindex="-1"><a class="header-anchor" href="#supported-hardware" aria-hidden="true">#</a> Supported Hardware</h2><p>This library is compatible with any Arduino-based hardware, including ESP32, ESP8266 and AVR microprocessors.</p><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>When running on AVR MCUs the max MQTT message size is reduced to only 256 bytes, due to memory constraints on these devices. However for ESP32 and ESP8266 devices the max MQTT message size is 4096 bytes.</p></div><hr><h4 id="credits" tabindex="-1"><a class="header-anchor" href="#credits" aria-hidden="true">#</a> Credits</h4><ul><li><a href="https://oxrs.io/" target="_blank" rel="noopener noreferrer">OXRS<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> Core Team</li></ul><hr><h4 id="license" tabindex="-1"><a class="header-anchor" href="#license" aria-hidden="true">#</a> License</h4><p>Found <a href="https://github.com/OXRS-IO/OXRS-IO-MQTT-ESP32-LIB/blob/main/LICENSE" target="_blank" rel="noopener noreferrer">here<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>.</p><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="nav-link external meta-item-label" href="https://github.com/OXRS-IO/OXRS-IO-WEBSITE/edit/main/docs/docs/libraries/esp32-mqtt-library.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page"><!--[--><!--]--> Edit this page <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><span class="meta-item-info">11/30/2021, 2:09:50 AM</span></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: ben.jones12@gmail.com">Ben Jones</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: aaron_knox@me.com">Aaron Knox</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: 70245481+austinscreations@users.noreply.github.com">austinscreations</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><!----><span class="next"><a href="/docs/libraries/esp32-api-library.html" class="nav-link" aria-label="ESP32 API library"><!--[--><!--]--> ESP32 API library <!--[--><!--]--></a> → </span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script src="/assets/js/runtime~app.0f0626d7.js" defer></script><script src="/assets/js/8567.c9de17ef.js" defer></script><script src="/assets/js/app.8b53c3ee.js" defer></script>
  </body>
</html>
